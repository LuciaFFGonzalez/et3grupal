<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>API ET3 - Documentaci√≥n</title>
    <link rel="stylesheet" type="text/css" href="./Base/css/IU.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="./Base/css/estilo-1.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="./Base/css/estilo-2.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="./Base/css/estilo-tests.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="./app/css/IU.css" media="screen" />
    <style>
        body {
            padding: 1.5rem;
        }
        .api-wrapper {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .api-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .api-header h1 {
            margin: 0;
        }
        .api-home-link {
            text-decoration: none;
            padding: 0.5rem 0.75rem;
            border-radius: 4px;
        }
        .api-section {
            padding: 1rem;
            background: #fff;
        }
        .api-section h2 {
            margin-top: 0;
        }
        .api-table {
            width: 100%;
            border-collapse: collapse;
        }
        .api-table th,
        .api-table td {
            border: 1px solid #ccc;
            padding: 0.5rem;
            vertical-align: top;
        }
        .api-table th {
            background-color: #f2f2f2;
            text-align: left;
        }
        .api-empty {
            padding: 1rem;
        }
    </style>
</head>
<body>
    <div class="api-wrapper">
        <header class="api-header">
            <h1 class="api.header.title"></h1>
            <a class="api-home-link bordeado" href="./index.html"></a>
        </header>
        <p class="api-description"></p>
        <section id="api-docs-container"></section>
    </div>

    <script type="text/javascript" src="./locale/idioma.js"></script>
    <script type="text/javascript" src="./app/Textos_ES.js"></script>
    <script type="text/javascript" src="./app/Textos_EN.js"></script>
    <script type="text/javascript" src="./app/Textos_Comunes.js"></script>
    <script type="text/javascript" src="./Core/LanguageManager.js"></script>
    <script type="text/javascript" src="./app/apiDocData.js"></script>
    <script type="text/javascript">
        const apiLanguageManager = new LanguageManager({ defaultLanguage: 'ES' });
        const apiActiveLang = (typeof getCookie === 'function' && getCookie('lang')) || 'ES';
        apiLanguageManager.setLanguage(apiActiveLang);

        function translateStaticApiTexts() {
            const headerTitle = document.querySelector('.api-header h1');
            if (headerTitle) {
                headerTitle.textContent = apiLanguageManager.getText('api.header.title');
            }

            const homeLink = document.querySelector('.api-home-link');
            if (homeLink) {
                homeLink.textContent = apiLanguageManager.getText('api.header.back');
            }

            const description = document.querySelector('.api-description');
            if (description) {
                description.textContent = apiLanguageManager.getText('api.description');
            }

            document.title = apiLanguageManager.getText('api.header.title') || document.title;
        }

        function buildParamsText(params) {
            if (!Array.isArray(params) || params.length === 0) {
                return apiLanguageManager.getText('api.no.params');
            }
            return params.map((param) => {
                const description = param.description ? `: ${param.description}` : '';
                return `${param.name} (${param.type})${description}`;
            }).join('<br>');
        }

        function renderApiDocs(data) {
            const container = document.getElementById('api-docs-container');
            if (!container) return;

            if (!Array.isArray(data) || data.length === 0) {
                container.innerHTML = `<p class="api-empty bordeado">${apiLanguageManager.getText('api.empty')}</p>`;
                return;
            }

            const grouped = data.reduce((acc, item) => {
                if (!acc[item.className]) {
                    acc[item.className] = [];
                }
                acc[item.className].push(item);
                return acc;
            }, {});

            container.innerHTML = '';

            Object.entries(grouped).forEach(([className, methods]) => {
                const section = document.createElement('section');
                section.className = 'api-section bordeado';

                const title = document.createElement('h2');
                title.textContent = className;
                section.appendChild(title);

                const table = document.createElement('table');
                table.className = 'api-table';

                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                [
                    apiLanguageManager.getText('api.table.header.method'),
                    apiLanguageManager.getText('api.table.header.params'),
                    apiLanguageManager.getText('api.table.header.return'),
                    apiLanguageManager.getText('api.table.header.description')
                ].forEach((label) => {
                    const th = document.createElement('th');
                    th.textContent = label;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);
                table.appendChild(thead);

                const tbody = document.createElement('tbody');
                methods.forEach((method) => {
                    const row = document.createElement('tr');

                    const methodCell = document.createElement('td');
                    methodCell.textContent = method.methodName;
                    row.appendChild(methodCell);

                    const paramsCell = document.createElement('td');
                    paramsCell.innerHTML = buildParamsText(method.params);
                    row.appendChild(paramsCell);

                    const returnCell = document.createElement('td');
                    returnCell.textContent = method.returns || '';
                    row.appendChild(returnCell);

                    const descriptionCell = document.createElement('td');
                    descriptionCell.textContent = method.description || '';
                    row.appendChild(descriptionCell);

                    tbody.appendChild(row);
                });
                table.appendChild(tbody);

                section.appendChild(table);
                container.appendChild(section);
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            translateStaticApiTexts();
            renderApiDocs(window.apiDocData || []);
        });
    </script>
</body>
</html>
